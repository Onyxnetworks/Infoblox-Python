import openpyxl
from openpyxl import Workbook
import requests, json, time
from getpass import getpass
import argparse

# Ignore SSL Errors
requests.packages.urllib3.disable_warnings()

class colour:
   PURPLE = '\033[95m'
   CYAN = '\033[96m'
   DARKCYAN = '\033[36m'
   BLUE = '\033[94m'
   GREEN = '\033[92m'
   YELLOW = '\033[93m'
   RED = '\033[91m'
   BOLD = '\033[1m'
   UNDERLINE = '\033[4m'
   END = '\033[0m'

def ERRORS():
    print(colour.RED + 'Errors found. Exiting script.' + colour.END)
    time.sleep(2)
    exit()

def BANNER():
    print'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>'
    print 'Cisco ACI'
    print 'Tenant Fault Finder '
    print'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>'
    time.sleep(1)

def USERNAME_PASSWORD():
    print '\nPlease enter adm credentials.'
    ADM_USER = raw_input("\nEnter Username: ")
    ADM_PASS = getpass("\nEnter Password: ")

    return ADM_USER, ADM_PASS	

def APIC_LOGIN(BASE_URL, APIC_USERNAME, APIC_PASSWORD, HEADERS):
    # Log into APIC and generate a cookie for future requests
    login_url = BASE_URL + 'aaaLogin.json'
    auth = {"aaaUser": {"attributes": {"name": APIC_USERNAME, "pwd": APIC_PASSWORD}}}
    auth_payload = json.dumps(auth)
    try:
        post_response = requests.post(login_url, data=auth_payload, headers=HEADERS, verify=False)
        # Take token from response to use for future authentications
        payload_response = json.loads(post_response.text)
        token = payload_response['imdata'][0]['aaaLogin']['attributes']['token']
        APIC_COOKIE = {}
        APIC_COOKIE['APIC-Cookie'] = token
        print('Connected Successfully.')

    except:
        exit(colour.RED + 'Unable to connect to APIC. Please check your credentials' + colour.END)

    return APIC_COOKIE

def DELETE_IPG_FROM_EPG(BASE_URL, APIC_COOKIE, EPG, HEADERS):
    EPG_DN = "uni/tn-PRD1-MGT_TEN/ap-PRD1-MGT_APP/epg-{0}".format(EPG)
    PATH_1_DN = "uni/tn-PRD1-MGT_TEN/ap-PRD1-MGT_APP/epg-{0}/rspathAtt-[topology/pod-1/protpaths-103-104/pathep-[PRD1-VPC-111-112-P13_IPG]]".format(EPG)
    PATH_2_DN = "uni/tn-PRD1-MGT_TEN/ap-PRD1-MGT_APP/epg-{0}/rspathAtt-[topology/pod-1/protpaths-103-104/pathep-[PRD1-VPC-113-114-P13_IPG]]".format(EPG)
    DELETE_IPG_FROM_EPG_URL = BASE_URL + 'node/mo/uni/tn-PRD1-MGT_TEN/ap-PRD1-MGT_APP/epg-{0}.json'.format(EPG)
    DELETE_IPG_FROM_EPG_JSON = {"fvAEPg": {"attributes": {"dn": EPG_DN,"status": "modified"},"children": [{"fvRsPathAtt": {"attributes": {"dn": PATH_1_DN,"status": "deleted"},"children": []}},{"fvRsPathAtt": {"attributes": {"dn": PATH_2_DN,"status": "deleted"},"children": []}}]}}
  
    #print(DELETE_IPG_FROM_EPG_URL)
    #print('\n')
    #print(json.dumps(DELETE_IPG_FROM_EPG_JSON))
	
    try:
        post_response = requests.post(DELETE_IPG_FROM_EPG_URL, cookies=APIC_COOKIE, data=json.dumps(DELETE_IPG_FROM_EPG_JSON), headers=HEADERS, verify=False)
        DELETE_IPG_FROM_EPG_RESPONSE = json.loads(post_response.text)
		
        print(colour.BOLD + 'Deleted IPG: ' + PATH_1_DN + ' from EPG: ' + EPG + colour.END)
        print(colour.BOLD + 'Deleted IPG: ' + PATH_2_DN + ' from EPG: ' + EPG + colour.END)
        print('\n')
        print(DELETE_IPG_FROM_EPG_RESPONSE)
        return DELETE_IPG_FROM_EPG_RESPONSE
    
    
    except:
        exit(colour.RED + 'Failed to remove IPG for: ' + EPG + colour.END)	




def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("-v", "-verbose", help="Increase output verbosity", action="store_true")
    args = parser.parse_args()
    if args.v:
	    print('\nDebugging Enabled\n')
    ERROR = False
    HEADERS = {'content-type': 'application/json'}
    BASE_URL = 'https://sandboxapicdc.cisco.com/api/'
    USER_DETAILS = USERNAME_PASSWORD()
    APIC_USERNAME = USER_DETAILS[0]
    APIC_PASSWORD = USER_DETAILS[1]
	
    APIC_COOKIE = APIC_LOGIN(BASE_URL, APIC_USERNAME, APIC_PASSWORD, HEADERS)
    if APIC_COOKIE:
        time.sleep(2)
        print('\nSuccessfully generated authentication cookie')
    else:
        exit(colour.RED + '\nUnable to connect to APIC. Please check your credentials' + colour.END)
	
    EPG_LIST = ['PRD1-VL1005_EPG', 'PRD1-VL1006_EPG', 'PRD1-VL1008_EPG', 'PRD1-VL1009_EPG', 'PRD1-VL1016_EPG', 'PRD1-VL1007_EPG', 'PRD1-VL1099_EPG', 'PRD1-VL766_EPG', 'PRD1-VL1680_EPG', 'PRD1-VL1046_EPG', 'PRD1-VL1582_EPG', 'PRD1-VL1406_EPG', 'PRD1-VL886_EPG', 'PRD1-VL1865_EPG', 'PRD1-VL711_EPG', 'PRD1-VL1482_EPG', 'PRD1-VL1490_EPG', 'PRD1-VL750_EPG', 'PRD1-VL1013_EPG', 'PRD1-VL708_EPG', 'PRD1-VL1595_EPG', 'PRD1-VL1440_EPG', 'PRD1-VL1404_EPG', 'PRD1-VL1781_EPG', 'PRD1-VL707_EPG', 'PRD1-VL855_EPG', 'PRD1-VL808_EPG', 'PRD1-VL1873_EPG', 'PRD1-VL1707_EPG', 'PRD1-VL522_EPG', 'PRD1-VL1084_EPG', 'PRD1-VL503_EPG', 'PRD1-VL1520_EPG', 'PRD1-VL1447_EPG', 'PRD1-VL1869_EPG', 'PRD1-VL1822_EPG', 'PRD1-VL1003_EPG', 'PRD1-VL1446_EPG', 'PRD1-VL1050_EPG', 'PRD1-VL1082_EPG', 'PRD1-VL1402_EPG', 'PRD1-VL1410_EPG', 'PRD1-VL1411_EPG', 'PRD1-VL713_EPG', 'PRD1-VL1438_EPG', 'PRD1-VL1702_EPG', 'PRD1-VL853_EPG', 'PRD1-VL1703_EPG', 'PRD1-VL501_EPG', 'PRD1-VL754_EPG', 'PRD1-VL1443_EPG', 'PRD1-VL861_EPG', 'PRD1-VL1701_EPG', 'PRD1-VL885_EPG', 'PRD1-VL1690_EPG', 'PRD1-VL860_EPG', 'PRD1-VL1823_EPG', 'PRD1-VL760_EPG', 'PRD1-VL880_EPG', 'PRD1-VL1866_EPG', 'PRD1-VL1820_EPG', 'PRD1-VL1705_EPG', 'PRD1-VL521_EPG', 'PRD1-VL590_EPG', 'PRD1-VL889_EPG', 'PRD1-VL900_EPG', 'PRD1-VL752_EPG', 'PRD1-VL1483_EPG', 'PRD1-VL1407_EPG', 'PRD1-VL1492_EPG', 'PRD1-VL1428_EPG', 'PRD1-VL1080_EPG', 'PRD1-VL881_EPG', 'PRD1-VL1577_EPG', 'PRD1-VL514_EPG', 'PRD1-VL1015_EPG', 'PRD1-VL890_EPG', 'PRD1-VL1014_EPG', 'PRD1-VL1423_EPG', 'PRD1-VL497_EPG', 'PRD1-VL1000_EPG', 'PRD1-VL591_EPG', 'PRD1-VL517_EPG', 'PRD1-VL1799_EPG', 'PRD1-VL1426_EPG', 'PRD1-VL893_EPG', 'PRD1-VL1560_EPG', 'PRD1-VL1415_EPG', 'PRD1-VL1442_EPG', 'PRD1-VL1575_EPG', 'PRD1-VL1408_EPG', 'PRD1-VL892_EPG', 'PRD1-VL888_EPG', 'PRD1-VL1783_EPG', 'PRD1-VL1010_EPG', 'PRD1-VL520_EPG', 'PRD1-VL502_EPG', 'PRD1-VL777_EPG', 'PRD1-VL1782_EPG', 'PRD1-VL878_EPG', 'PRD1-VL1018_EPG', 'PRD1-VL1421_EPG', 'PRD1-VL1414_EPG', 'PRD1-VL1412_EPG', 'PRD1-VL512_EPG', 'PRD1-VL1576_EPG', 'PRD1-VL1409_EPG', 'PRD1-VL500_EPG', 'PRD1-VL1425_EPG', 'PRD1-VL1523_EPG', 'PRD1-VL1561_EPG', 'PRD1-VL862_EPG', 'PRD1-VL761_EPG', 'PRD1-VL1861_EPG', 'PRD1-VL891_EPG', 'PRD1-VL712_EPG', 'PRD1-VL1708_EPG', 'PRD1-VL1521_EPG', 'PRD1-VL1821_EPG', 'PRD1-VL508_EPG', 'PRD1-VL851_EPG', 'PRD1-VL1418_EPG', 'PRD1-VL1682_EPG', 'PRD1-VL1061_EPG', 'PRD1-VL1405_EPG', 'PRD1-VL1780_EPG', 'PRD1-VL513_EPG', 'PRD1-VL1400_EPG', 'PRD1-VL1484_EPG', 'PRD1-VL1860_EPG', 'PRD1-VL1436_EPG', 'PRD1-VL1593_EPG', 'PRD1-VL507_EPG', 'PRD1-VL1445_EPG', 'PRD1-VL1592_EPG', 'PRD1-VL1450_EPG', 'PRD1-VL882_EPG', 'PRD1-VL515_EPG', 'PRD1-VL1784_EPG', 'PRD1-VL594_EPG', 'PRD1-VL1686_EPG', 'PRD1-VL1448_EPG', 'PRD1-VL1040_EPG', 'PRD1-VL1422_EPG', 'PRD1-VL1488_EPG', 'PRD1-VL751_EPG', 'PRD1-VL1420_EPG', 'PRD1-VL1578_EPG', 'PRD1-VL756_EPG', 'PRD1-VL1529_EPG', 'PRD1-VL1441_EPG', 'PRD1-VL806_EPG', 'PRD1-VL1439_EPG', 'PRD1-VL1710_EPG', 'PRD1-VL763_EPG', 'PRD1-VL753_EPG', 'PRD1-VL592_EPG', 'PRD1-VL807_EPG', 'PRD1-VL510_EPG', 'PRD1-VL1429_EPG', 'PRD1-VL1417_EPG', 'PRD1-VL804_EPG', 'PRD1-VL764_EPG', 'PRD1-VL1481_EPG', 'PRD1-VL762_EPG', 'PRD1-VL1002_EPG', 'PRD1-VL1599_EPG', 'PRD1-VL1590_EPG', 'PRD1-VL1980_EPG', 'PRD1-VL895_EPG', 'PRD1-VL505_EPG', 'PRD1-VL850_EPG', 'PRD1-VL884_EPG', 'PRD1-VL1055_EPG', 'PRD1-VL765_EPG', 'PRD1-VL809_EPG', 'PRD1-VL1709_EPG', 'PRD1-VL1700_EPG', 'PRD1-VL1001_EPG', 'PRD1-VL722_EPG', 'PRD1-VL854_EPG', 'PRD1-VL710_EPG', 'PRD1-VL805_EPG', 'PRD1-VL1706_EPG', 'PRD1-VL894_EPG', 'PRD1-VL1525_EPG', 'PRD1-VL524_EPG', 'PRD1-VL1063_EPG', 'PRD1-VL1062_EPG', 'PRD1-VL899_EPG', 'PRD1-VL593_EPG', 'PRD1-VL504_EPG', 'PRD1-VL1787_EPG', 'PRD1-VL511_EPG', 'PRD1-VL1491_EPG', 'PRD1-VL523_EPG', 'PRD1-VL1004_EPG', 'PRD1-VL1012_EPG', 'PRD1-VL1011_EPG', 'PRD1-VL1480_EPG', 'PRD1-VL1487_EPG', 'PRD1-VL898_EPG', 'PRD1-VL1041_EPG', 'PRD1-VL852_EPG', 'PRD1-VL887_EPG', 'PRD1-VL1042_EPG', 'PRD1-VL1043_EPG', 'PRD1-VL1413_EPG', 'PRD1-VL1419_EPG', 'PRD1-VL1044_EPG', 'PRD1-VL709_EPG', 'PRD1-VL1416_EPG', 'PRD1-VL879_EPG', 'PRD1-VL1060_EPG', 'PRD1-VL1081_EPG', 'PRD1-VL1522_EPG', 'PRD1-VL1083_EPG', 'PRD1-VL1401_EPG', 'PRD1-VL1403_EPG', 'PRD1-VL1017_EPG', 'PRD1-VL1019_EPG', 'PRD1-VL1045_EPG', 'PRD1-VL1047_EPG', 'PRD1-VL1048_EPG', 'PRD1-VL1049_EPG', 'PRD1-VL1051_EPG', 'PRD1-VL1052_EPG', 'PRD1-VL1053_EPG', 'PRD1-VL1054_EPG', 'PRD1-VL1056_EPG', 'PRD1-VL1057_EPG', 'PRD1-VL1058_EPG', 'PRD1-VL1059_EPG', 'PRD1-VL1424_EPG', 'PRD1-VL1427_EPG', 'PRD1-VL1430_EPG', 'PRD1-VL1431_EPG', 'PRD1-VL1432_EPG', 'PRD1-VL1433_EPG', 'PRD1-VL1434_EPG', 'PRD1-VL1435_EPG', 'PRD1-VL1437_EPG', 'PRD1-VL1485_EPG', 'PRD1-VL1486_EPG', 'PRD1-VL1493_EPG', 'PRD1-VL1494_EPG', 'PRD1-VL1495_EPG', 'PRD1-VL1496_EPG', 'PRD1-VL1497_EPG', 'PRD1-VL1498_EPG', 'PRD1-VL1499_EPG', 'PRD1-VL1500_EPG', 'PRD1-VL1501_EPG', 'PRD1-VL1502_EPG', 'PRD1-VL1503_EPG', 'PRD1-VL1504_EPG', 'PRD1-VL1505_EPG', 'PRD1-VL1506_EPG', 'PRD1-VL1507_EPG', 'PRD1-VL1508_EPG', 'PRD1-VL1509_EPG', 'PRD1-VL1510_EPG', 'PRD1-VL1511_EPG', 'PRD1-VL1512_EPG', 'PRD1-VL1513_EPG', 'PRD1-VL1514_EPG', 'PRD1-VL1515_EPG', 'PRD1-VL1516_EPG', 'PRD1-VL1517_EPG', 'PRD1-VL1518_EPG', 'PRD1-VL1519_EPG', 'PRD1-VL1569_EPG', 'PRD1-VL1704_EPG', 'PRD1-VL1711_EPG', 'PRD1-VL1712_EPG', 'PRD1-VL1713_EPG', 'PRD1-VL1714_EPG', 'PRD1-VL1715_EPG', 'PRD1-VL1716_EPG', 'PRD1-VL1717_EPG', 'PRD1-VL1718_EPG', 'PRD1-VL1719_EPG', 'PRD1-VL1720_EPG', 'PRD1-VL1721_EPG', 'PRD1-VL1722_EPG', 'PRD1-VL1723_EPG', 'PRD1-VL1724_EPG', 'PRD1-VL1725_EPG', 'PRD1-VL1726_EPG', 'PRD1-VL1727_EPG', 'PRD1-VL1728_EPG', 'PRD1-VL1729_EPG', 'PRD1-VL1730_EPG', 'PRD1-VL1731_EPG', 'PRD1-VL1732_EPG', 'PRD1-VL1733_EPG', 'PRD1-VL1734_EPG', 'PRD1-VL1735_EPG', 'PRD1-VL1736_EPG', 'PRD1-VL1737_EPG', 'PRD1-VL1738_EPG', 'PRD1-VL1739_EPG', 'PRD1-VL1785_EPG', 'PRD1-VL1786_EPG', 'PRD1-VL1788_EPG', 'PRD1-VL1789_EPG', 'PRD1-VL1790_EPG', 'PRD1-VL1791_EPG', 'PRD1-VL1792_EPG', 'PRD1-VL1793_EPG', 'PRD1-VL1794_EPG', 'PRD1-VL1795_EPG', 'PRD1-VL1796_EPG', 'PRD1-VL1797_EPG', 'PRD1-VL1798_EPG', 'PRD1-VL1800_EPG', 'PRD1-VL1801_EPG', 'PRD1-VL1802_EPG', 'PRD1-VL1803_EPG', 'PRD1-VL1804_EPG', 'PRD1-VL1805_EPG', 'PRD1-VL1806_EPG', 'PRD1-VL1807_EPG', 'PRD1-VL1808_EPG', 'PRD1-VL1809_EPG', 'PRD1-VL1810_EPG', 'PRD1-VL1811_EPG', 'PRD1-VL1812_EPG', 'PRD1-VL1813_EPG', 'PRD1-VL1814_EPG', 'PRD1-VL1815_EPG', 'PRD1-VL1816_EPG', 'PRD1-VL1817_EPG', 'PRD1-VL1818_EPG', 'PRD1-VL1819_EPG', 'PRD1-VL506_EPG', 'PRD1-VL509_EPG', 'PRD1-VL516_EPG', 'PRD1-VL518_EPG', 'PRD1-VL519_EPG', 'PRD1-VL700_EPG', 'PRD1-VL715_EPG', 'PRD1-VL724_EPG', 'PRD1-VL726_EPG', 'PRD1-VL727_EPG', 'PRD1-VL779_EPG', 'PRD1-VL1489_EPG', 'PRD1-VL1020_EPG', 'PRD1-VL1451_EPG']
	
    for EPG in EPG_LIST:
		#print(EPG)
		DELETE_IPG_FROM_EPG(BASE_URL, APIC_COOKIE, EPG, HEADERS)

   


if __name__ == "__main__":
    main()
